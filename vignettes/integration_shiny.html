<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Sébastien Calvet" />

<meta name="date" content="2019-08-23" />

<title>Intégration dans les applications shiny</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">Intégration dans les applications shiny</h1>
<h4 class="author">Sébastien Calvet</h4>
<h4 class="date">2019-08-23</h4>


<div id="TOC">
<ul>
<li><a href="#ronds-proportionnels">Ronds proportionnels</a></li>
<li><a href="#analyse-en-classes">Analyse en classes</a></li>
<li><a href="#fleches-joignantes">Flèches joignantes</a></li>
</ul>
</div>

<p>Les fonctions leaflet_ peuvent être utilisées dans 2 contextes différents :</p>
<ul>
<li><p>Appel direct d’une fonction leaflet_ dans l’environnement RStudio. Dans ce cas, la carte s’affiche dans la fenêtre Viewer (ctrl+9). Il s’agit là d’un contexte ‘leaflet’ classique.</p></li>
<li><p>Dans une application shiny, les fonctions leaflet_ peuvent être utilisées pour actualiser des cartes à chaque changement de paramètres grâce à leaflet_proxy. L’intérêt ici est de ne pas recharger toutes les couches de la carte mais uniquement celles qui doivent être actualisées. Le temps de rafraîchissement est alors réduit. C’est le contexte ‘proxy’.</p></li>
</ul>
<p>Il est bien sûr possible d’appeler des fonctions leaflet_ dans une application shiny avec un contexte ‘leaflet’, mais dans ce cas toute la carte sera rechargée dès qu’un paramètre sera modifié.</p>
<p>Ci-dessous, quelques exemples d’applications shiny intégrant les fonctions leaflet_ dans un contexte ‘proxy’.</p>
<div id="ronds-proportionnels" class="section level2">
<h2>Ronds proportionnels</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="kw">library</span>(oceanis)
  <span class="kw">library</span>(shiny)

  <span class="kw">shinyApp</span>(

    <span class="dt">ui =</span> <span class="kw">fluidPage</span>(
        <span class="kw">sidebarLayout</span>(
          <span class="kw">sidebarPanel</span>(
            <span class="kw">uiOutput</span>(<span class="st">&quot;lngRonds_out&quot;</span>),
            <span class="kw">uiOutput</span>(<span class="st">&quot;latRonds_out&quot;</span>),
            <span class="kw">uiOutput</span>(<span class="st">&quot;rayon_rond_out&quot;</span>),
            <span class="kw">uiOutput</span>(<span class="st">&quot;opaciteElargie_out&quot;</span>),
            <span class="kw">uiOutput</span>(<span class="st">&quot;colPos_out&quot;</span>),
            <span class="kw">uiOutput</span>(<span class="st">&quot;colBorderRonds_out&quot;</span>)
          ),
          <span class="kw">mainPanel</span>(
            <span class="kw">leafletOutput</span>(<span class="st">&quot;carte&quot;</span>, <span class="dt">height =</span> <span class="dv">900</span>)
          )
        )
    ),

    <span class="dt">server =</span> <span class="cf">function</span>(input, output){

      <span class="co"># Declaration et envoi des widgets a l'ui</span>
      output<span class="op">$</span>lngRonds_out &lt;-<span class="st"> </span><span class="kw">renderUI</span>({
        <span class="kw">numericInput</span>(<span class="st">&quot;lngRonds&quot;</span>, <span class="st">&quot;Longitude de la legende des ronds&quot;</span>, <span class="dt">value =</span> <span class="dv">9</span>)
      })
      output<span class="op">$</span>latRonds_out &lt;-<span class="st"> </span><span class="kw">renderUI</span>({
        <span class="kw">numericInput</span>(<span class="st">&quot;latRonds&quot;</span>, <span class="st">&quot;Latitude de la legende des ronds&quot;</span>, <span class="dt">value =</span> <span class="dv">49</span>)
      })
      output<span class="op">$</span>rayon_rond_out &lt;-<span class="st"> </span><span class="kw">renderUI</span>({
        <span class="kw">numericInput</span>(<span class="st">&quot;rayon_rond&quot;</span>, <span class="st">&quot;Rayon du rond le plus grand&quot;</span>, <span class="dt">value =</span> <span class="dv">30000</span>)
      })
      output<span class="op">$</span>opaciteElargie_out &lt;-<span class="st"> </span><span class="kw">renderUI</span>({
        <span class="kw">sliderInput</span>(<span class="st">&quot;opaciteElargie&quot;</span>, <span class="st">&quot;Opacite de la representation elargie&quot;</span>,
                    <span class="dt">min=</span><span class="dv">0</span>,<span class="dt">max=</span><span class="dv">100</span>,<span class="dt">value=</span><span class="dv">60</span>,<span class="dt">step=</span><span class="dv">10</span>,<span class="dt">ticks=</span><span class="ot">FALSE</span>)
      })
      output<span class="op">$</span>colPos_out &lt;-<span class="st"> </span><span class="kw">renderUI</span>({
        <span class="kw">textInput</span>(<span class="st">&quot;colPos&quot;</span>, <span class="st">&quot;Couleur de remplissage des ronds&quot;</span>, <span class="dt">value =</span> <span class="kw">c</span>(<span class="st">&quot;#CD853F&quot;</span>))
      })
      output<span class="op">$</span>colBorderRonds_out &lt;-<span class="st"> </span><span class="kw">renderUI</span>({
        <span class="kw">textInput</span>(<span class="st">&quot;colBorderRonds&quot;</span>, <span class="st">&quot;Couleur de la bordure des ronds&quot;</span>, <span class="dt">value =</span> <span class="kw">c</span>(<span class="st">&quot;#303030&quot;</span>))
      })
     
      <span class="co"># Initialisation et envoi de la carte leaflet a l'ui</span>
      output<span class="op">$</span>carte &lt;-<span class="st"> </span><span class="kw">renderLeaflet</span>({
        map &lt;-<span class="st"> </span><span class="kw">leaflet_ronds</span>(<span class="dt">data =</span> donnees_monoloc,
                            <span class="dt">fondMaille =</span> depm[depm<span class="op">$</span>REG <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;84&quot;</span>,<span class="st">&quot;93&quot;</span>),],
                            <span class="dt">fondMailleElargi =</span> depm,
                            <span class="dt">idData =</span> <span class="st">&quot;COD_DEP&quot;</span>,
                            <span class="dt">varVolume =</span> <span class="st">&quot;POP_2015&quot;</span>,
                            <span class="dt">map_proxy =</span> <span class="st">&quot;shiny&quot;</span>)
      })

      <span class="co"># Reactive pour actualiser la carte leaflet</span>
      react_carte &lt;-<span class="st"> </span><span class="kw">reactive</span>({
        map &lt;-<span class="st"> </span><span class="kw">leaflet_ronds</span>(<span class="dt">data =</span> donnees_monoloc,
                            <span class="dt">fondMaille =</span> depm[depm<span class="op">$</span>REG <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;84&quot;</span>,<span class="st">&quot;93&quot;</span>),],
                            <span class="dt">fondMailleElargi =</span> depm,
                            <span class="dt">idData =</span> <span class="st">&quot;COD_DEP&quot;</span>,
                            <span class="dt">varVolume =</span> <span class="st">&quot;POP_2015&quot;</span>,
                            <span class="dt">rayonRond =</span> <span class="kw">as.numeric</span>(input<span class="op">$</span>rayon_rond),
                            <span class="dt">opacityElargi =</span> <span class="kw">as.numeric</span>(input<span class="op">$</span>opaciteElargie)<span class="op">/</span><span class="dv">100</span>,
                            <span class="dt">colPos =</span> input<span class="op">$</span>colPos,
                            <span class="dt">colBorder =</span> input<span class="op">$</span>colBorderRonds,
                            <span class="dt">map_proxy =</span> <span class="st">&quot;shiny&quot;</span>)
      })

      <span class="co"># Deplacement de la legende des ronds</span>
      <span class="kw">observeEvent</span>(<span class="kw">list</span>(input<span class="op">$</span>lngRonds,input<span class="op">$</span>latRonds),{

        proxy &lt;-<span class="st"> </span><span class="kw">leafletProxy</span>(<span class="st">&quot;carte&quot;</span>)

        <span class="co"># on passe la carte leaflet en parametre (map_leaflet = react_carte()).</span>
        <span class="co"># on met a jour la carte proxy pour la nouvelle position de la legende des ronds.</span>
        proxy &lt;-<span class="st"> </span><span class="kw">add_legende_ronds</span>(<span class="dt">map =</span> proxy, 
                                  <span class="dt">titre =</span> <span class="st">&quot;POP_2015&quot;</span>,
                                  <span class="dt">lng =</span> <span class="kw">as.numeric</span>(input<span class="op">$</span>lngRonds),
                                  <span class="dt">lat =</span> <span class="kw">as.numeric</span>(input<span class="op">$</span>latRonds),
                                  <span class="dt">zoom =</span> <span class="dv">6</span>,
                                  <span class="dt">map_leaflet =</span> <span class="kw">react_carte</span>())
      }, <span class="dt">ignoreInit =</span> T)
  
      <span class="co"># Modification de la taille des ronds</span>
      <span class="kw">observeEvent</span>(input<span class="op">$</span>rayon_rond,{

        proxy &lt;-<span class="st"> </span><span class="kw">leafletProxy</span>(<span class="st">&quot;carte&quot;</span>)

        <span class="co"># on passe le proxy en parametre (map_proxy = proxy).</span>
        <span class="co"># on utilise isolate() autour des input qui ne changent pas d'etat dans cet observeEvent</span>
        <span class="co"># pour eviter le rafraichissement intempestif de la carte.</span>
        <span class="co"># on met a jour la carte proxy avec la nouvelle taille des ronds.</span>
        proxy &lt;-<span class="st"> </span><span class="kw">leaflet_ronds</span>(<span class="dt">data =</span> donnees_monoloc,
                              <span class="dt">fondMaille =</span> depm[depm<span class="op">$</span>REG <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;84&quot;</span>,<span class="st">&quot;93&quot;</span>),],
                              <span class="dt">fondMailleElargi =</span> depm,
                              <span class="dt">idData =</span> <span class="st">&quot;COD_DEP&quot;</span>,
                              <span class="dt">varVolume =</span> <span class="st">&quot;POP_2015&quot;</span>,
                              <span class="dt">rayonRond =</span> <span class="kw">as.numeric</span>(input<span class="op">$</span>rayon_rond),
                              <span class="dt">opacityElargi =</span> <span class="kw">as.numeric</span>(<span class="kw">isolate</span>(input<span class="op">$</span>opaciteElargie))<span class="op">/</span><span class="dv">100</span>,
                              <span class="dt">colPos =</span> <span class="kw">isolate</span>(input<span class="op">$</span>colPos),
                              <span class="dt">colBorder =</span> <span class="kw">isolate</span>(input<span class="op">$</span>colBorderRonds),
                              <span class="dt">map_proxy =</span> proxy)

        <span class="co"># on passe la carte leaflet en parametre (map_leaflet = react_carte()).</span>
        <span class="co"># on met a jour la carte proxy pour la nouvelle taille des ronds de la legende.</span>
        proxy &lt;-<span class="st"> </span><span class="kw">add_legende_ronds</span>(<span class="dt">map =</span> proxy,
                                  <span class="dt">titre =</span> <span class="st">&quot;POP_2015&quot;</span>,
                                  <span class="dt">lng =</span> <span class="kw">as.numeric</span>(<span class="kw">isolate</span>(input<span class="op">$</span>lngRonds)),
                                  <span class="dt">lat =</span> <span class="kw">as.numeric</span>(<span class="kw">isolate</span>(input<span class="op">$</span>latRonds)),
                                  <span class="dt">zoom =</span> <span class="dv">6</span>,
                                  <span class="dt">map_leaflet =</span> <span class="kw">react_carte</span>())
      }, <span class="dt">ignoreInit =</span> T)
    
      <span class="co"># Modification de l'opacite de la representation elargie</span>
      <span class="kw">observeEvent</span>(input<span class="op">$</span>opaciteElargie,{

        proxy &lt;-<span class="st"> </span><span class="kw">leafletProxy</span>(<span class="st">&quot;carte&quot;</span>)

        <span class="co"># on passe la carte leaflet en parametre (map_leaflet = react_carte()).</span>
        <span class="co"># on met a jour la carte proxy avec la nouvelle opacite de la representation elargie.</span>
        proxy &lt;-<span class="st"> </span><span class="kw">set_opacite_elargi</span>(<span class="dt">map =</span> proxy,
                                    <span class="dt">opacite =</span> <span class="kw">as.numeric</span>(input<span class="op">$</span>opaciteElargie)<span class="op">/</span><span class="dv">100</span>,
                                    <span class="dt">map_leaflet =</span> <span class="kw">react_carte</span>())
      }, <span class="dt">ignoreInit =</span> T)
    
      <span class="co"># Modification de la couleur des ronds</span>
      <span class="kw">observeEvent</span>(<span class="kw">list</span>(input<span class="op">$</span>colPos,input<span class="op">$</span>colBorderRonds),{

        proxy &lt;-<span class="st"> </span><span class="kw">leafletProxy</span>(<span class="st">&quot;carte&quot;</span>)

        <span class="co"># on passe la carte leaflet en parametre (map_leaflet = react_carte()).</span>
        <span class="co"># on met a jour la carte proxy pour les nouvelles couleurs des ronds et de leur bordure.</span>
        proxy &lt;-<span class="st"> </span><span class="kw">set_couleur_ronds</span>(<span class="dt">map =</span> proxy,
                                  <span class="dt">colorPos =</span> input<span class="op">$</span>colPos,
                                  <span class="dt">colBorder =</span> input<span class="op">$</span>colBorderRonds,
                                  <span class="dt">map_leaflet =</span> <span class="kw">react_carte</span>())
      
        <span class="co"># ou bien en passant les parametres directement dans la fonction leaflet_ronds()</span>
        <span class="co"># avec map_proxy = proxy.</span>
        <span class="co"># selon les cas, cette solution peut etre plus longue.</span>
        <span class="co"># proxy &lt;- leaflet_ronds(data = donnees_monoloc,</span>
        <span class="co">#                       fondMaille = depm[depm$REG %in% c(&quot;84&quot;,&quot;93&quot;),],</span>
        <span class="co">#                       fondMailleElargi = depm,</span>
        <span class="co">#                       idData = &quot;COD_DEP&quot;,</span>
        <span class="co">#                       varVolume = &quot;POP_2015&quot;,</span>
        <span class="co">#                       rayonRond = as.numeric(isolate(input$rayon_rond)),</span>
        <span class="co">#                       colPos = input$colPos,</span>
        <span class="co">#                       colBorder = input$colBorderRonds,</span>
        <span class="co">#                       opacityElargi = as.numeric(isolate(input$opaciteElargie))/100,</span>
        <span class="co">#                       map_proxy = proxy)</span>
      }, <span class="dt">ignoreInit =</span> T)
    }
  )</code></pre></div>
</div>
<div id="analyse-en-classes" class="section level2">
<h2>Analyse en classes</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="kw">library</span>(oceanis)
  <span class="kw">library</span>(shiny)

  <span class="kw">shinyApp</span>(

    <span class="dt">ui =</span> <span class="kw">fluidPage</span>(
        <span class="kw">sidebarLayout</span>(
          <span class="kw">sidebarPanel</span>(
            <span class="kw">uiOutput</span>(<span class="st">&quot;lngClasses_out&quot;</span>),
            <span class="kw">uiOutput</span>(<span class="st">&quot;latClasses_out&quot;</span>),
            <span class="kw">uiOutput</span>(<span class="st">&quot;nb_classes_out&quot;</span>),
            <span class="kw">uiOutput</span>(<span class="st">&quot;opaciteElargie_out&quot;</span>),
            <span class="kw">uiOutput</span>(<span class="st">&quot;stylePalette_out&quot;</span>),
            <span class="kw">uiOutput</span>(<span class="st">&quot;colBorder_out&quot;</span>)
          ),
          <span class="kw">mainPanel</span>(
            <span class="kw">leafletOutput</span>(<span class="st">&quot;carte&quot;</span>, <span class="dt">height =</span> <span class="dv">900</span>)
          )
        )
    ),

    <span class="dt">server =</span> <span class="cf">function</span>(input, output){

      <span class="co"># Declaration et envoi des widgets a l'ui</span>
      output<span class="op">$</span>lngClasses_out &lt;-<span class="st"> </span><span class="kw">renderUI</span>({
        <span class="kw">numericInput</span>(<span class="st">&quot;lngClasses&quot;</span>, <span class="st">&quot;Longitude de la legende des classes&quot;</span>, <span class="dt">value =</span> <span class="dv">9</span>)
      })
      output<span class="op">$</span>latClasses_out &lt;-<span class="st"> </span><span class="kw">renderUI</span>({
        <span class="kw">numericInput</span>(<span class="st">&quot;latClasses&quot;</span>, <span class="st">&quot;Latitude de la legende des classes&quot;</span>, <span class="dt">value =</span> <span class="dv">49</span>)
      })
      output<span class="op">$</span>nb_classes_out &lt;-<span class="st"> </span><span class="kw">renderUI</span>({
        <span class="kw">numericInput</span>(<span class="st">&quot;nb_classes&quot;</span>, <span class="st">&quot;Nombre de classes&quot;</span>, <span class="dt">value =</span> <span class="dv">4</span>)
      })
      output<span class="op">$</span>opaciteElargie_out &lt;-<span class="st"> </span><span class="kw">renderUI</span>({
        <span class="kw">sliderInput</span>(<span class="st">&quot;opaciteElargie&quot;</span>, <span class="st">&quot;Opacite de la representation elargie&quot;</span>,
                    <span class="dt">min=</span><span class="dv">0</span>,<span class="dt">max=</span><span class="dv">100</span>,<span class="dt">value=</span><span class="dv">60</span>,<span class="dt">step=</span><span class="dv">10</span>,<span class="dt">ticks=</span><span class="ot">FALSE</span>)
      })
      output<span class="op">$</span>stylePalette_out &lt;-<span class="st"> </span><span class="kw">renderUI</span>({
        <span class="kw">selectInput</span>(<span class="st">&quot;stylePalette&quot;</span>, <span class="st">&quot;Style Insee de la palette&quot;</span>,
                    <span class="dt">choices =</span> <span class="kw">c</span>(<span class="st">&quot;defaut&quot;</span>, <span class="st">&quot;InseeFlash&quot;</span>, <span class="st">&quot;InseeAnalyse&quot;</span>,
                                <span class="st">&quot;InseeDossier&quot;</span>, <span class="st">&quot;InseePremiere&quot;</span>),
                    <span class="dt">selected =</span> <span class="st">&quot;defaut&quot;</span>)
      })
      output<span class="op">$</span>colBorder_out &lt;-<span class="st"> </span><span class="kw">renderUI</span>({
        <span class="kw">textInput</span>(<span class="st">&quot;colBorderClasses&quot;</span>, <span class="st">&quot;Couleur de la bordure des classes&quot;</span>, <span class="dt">value =</span> <span class="kw">c</span>(<span class="st">&quot;white&quot;</span>))
      })
           
      <span class="co"># Initialisation et envoi de la carte leaflet a l'ui</span>
      output<span class="op">$</span>carte &lt;-<span class="st"> </span><span class="kw">renderLeaflet</span>({
        map &lt;-<span class="st"> </span><span class="kw">leaflet_classes</span>(<span class="dt">data =</span> donnees_monoloc,
                              <span class="dt">fondMaille =</span> depm[depm<span class="op">$</span>REG <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;84&quot;</span>,<span class="st">&quot;93&quot;</span>),],
                              <span class="dt">fondMailleElargi =</span> depm,
                              <span class="dt">idData =</span> <span class="st">&quot;COD_DEP&quot;</span>,
                              <span class="dt">varRatio =</span> <span class="st">&quot;VAR_AN_MOY&quot;</span>,
                              <span class="dt">nbClasses =</span> <span class="dv">4</span>,
                              <span class="dt">map_proxy =</span> <span class="st">&quot;shiny&quot;</span>)
      })

      <span class="co"># Reactive pour actualiser la carte leaflet</span>
      react_carte &lt;-<span class="st"> </span><span class="kw">reactive</span>({
        map &lt;-<span class="st"> </span><span class="kw">leaflet_classes</span>(<span class="dt">data =</span> donnees_monoloc,
                              <span class="dt">fondMaille =</span> depm[depm<span class="op">$</span>REG <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;84&quot;</span>,<span class="st">&quot;93&quot;</span>),],
                              <span class="dt">fondMailleElargi =</span> depm,
                              <span class="dt">idData =</span> <span class="st">&quot;COD_DEP&quot;</span>,
                              <span class="dt">varRatio =</span> <span class="st">&quot;VAR_AN_MOY&quot;</span>,
                              <span class="dt">nbClasses =</span> <span class="kw">as.numeric</span>(input<span class="op">$</span>nb_classes),
                              <span class="dt">stylePalette =</span> input<span class="op">$</span>stylePalette,
                              <span class="dt">opacityElargi =</span> <span class="kw">as.numeric</span>(input<span class="op">$</span>opaciteElargie)<span class="op">/</span><span class="dv">100</span>,
                              <span class="dt">colBorder =</span> input<span class="op">$</span>colBorderClasses,
                              <span class="dt">map_proxy =</span> <span class="st">&quot;shiny&quot;</span>)
      })

      <span class="co"># Reactive pour ajouter la legende de classes a la carte leaflet</span>
      react_legende_carte &lt;-<span class="st"> </span><span class="kw">reactive</span>({
        map &lt;-<span class="st"> </span><span class="kw">add_legende_classes</span>(<span class="dt">map =</span> <span class="kw">react_carte</span>(), 
                                  <span class="dt">titre =</span> <span class="st">&quot;VAR_AN_MOY&quot;</span>,
                                  <span class="dt">lng =</span> <span class="kw">as.numeric</span>(input<span class="op">$</span>lngClasses),
                                  <span class="dt">lat =</span> <span class="kw">as.numeric</span>(input<span class="op">$</span>latClasses),
                                  <span class="dt">zoom =</span> <span class="dv">6</span>)
      })

      <span class="co"># Deplacement de la legende des classes</span>
      <span class="kw">observeEvent</span>(<span class="kw">list</span>(input<span class="op">$</span>lngClasses,input<span class="op">$</span>latClasses),{

        proxy &lt;-<span class="st"> </span><span class="kw">leafletProxy</span>(<span class="st">&quot;carte&quot;</span>)

        <span class="co"># on passe la carte leaflet en parametre (map_leaflet = react_carte()).</span>
        <span class="co"># on met a jour la carte proxy pour la nouvelle position de la legende des classes.</span>
        proxy &lt;-<span class="st"> </span><span class="kw">add_legende_classes</span>(<span class="dt">map =</span> proxy, 
                                    <span class="dt">titre =</span> <span class="st">&quot;VAR_AN_MOY&quot;</span>,
                                    <span class="dt">lng =</span> <span class="kw">as.numeric</span>(input<span class="op">$</span>lngClasses),
                                    <span class="dt">lat =</span> <span class="kw">as.numeric</span>(input<span class="op">$</span>latClasses),
                                    <span class="dt">zoom =</span> <span class="dv">6</span>,
                                    <span class="dt">map_leaflet =</span> <span class="kw">react_carte</span>())
      }, <span class="dt">ignoreInit =</span> T)
  
      <span class="co"># Modification du nombre de classes</span>
      <span class="kw">observeEvent</span>(input<span class="op">$</span>nb_classes,{

        proxy &lt;-<span class="st"> </span><span class="kw">leafletProxy</span>(<span class="st">&quot;carte&quot;</span>)

        <span class="co"># on passe le proxy en parametre (map_proxy = proxy).</span>
        <span class="co"># on utilise isolate() autour des input qui ne changent pas d'etat dans cet observeEvent</span>
        <span class="co"># pour eviter le rafraichissement intempestif de la carte.</span>
        <span class="co"># on met a jour la carte proxy avec le nouveau nombre de classes.</span>
        proxy &lt;-<span class="st"> </span><span class="kw">leaflet_classes</span>(<span class="dt">data =</span> donnees_monoloc,
                                <span class="dt">fondMaille =</span> depm[depm<span class="op">$</span>REG <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;84&quot;</span>,<span class="st">&quot;93&quot;</span>),],
                                <span class="dt">fondMailleElargi =</span> depm,
                                <span class="dt">idData =</span> <span class="st">&quot;COD_DEP&quot;</span>,
                                <span class="dt">varRatio =</span> <span class="st">&quot;VAR_AN_MOY&quot;</span>,
                                <span class="dt">nbClasses =</span> <span class="kw">as.numeric</span>(input<span class="op">$</span>nb_classes),
                                <span class="dt">stylePalette =</span> <span class="kw">isolate</span>(input<span class="op">$</span>stylePalette),
                                <span class="dt">opacityElargi =</span> <span class="kw">as.numeric</span>(<span class="kw">isolate</span>(input<span class="op">$</span>opaciteElargie))<span class="op">/</span><span class="dv">100</span>,
                                <span class="dt">colBorder =</span> <span class="kw">isolate</span>(input<span class="op">$</span>colBorderClasses),
                                <span class="dt">map_proxy =</span> proxy)

        <span class="co"># on passe la carte leaflet en parametre (map_leaflet = react_carte()).</span>
        <span class="co"># on met a jour la carte proxy pour le nouveau nombre de classes dans la legende.</span>
        proxy &lt;-<span class="st"> </span><span class="kw">add_legende_classes</span>(<span class="dt">map =</span> proxy,
                                    <span class="dt">titre =</span> <span class="st">&quot;VAR_AN_MOY&quot;</span>,
                                    <span class="dt">lng =</span> <span class="kw">as.numeric</span>(<span class="kw">isolate</span>(input<span class="op">$</span>lngClasses)),
                                    <span class="dt">lat =</span> <span class="kw">as.numeric</span>(<span class="kw">isolate</span>(input<span class="op">$</span>latClasses)),
                                    <span class="dt">zoom =</span> <span class="dv">6</span>,
                                    <span class="dt">map_leaflet =</span> <span class="kw">react_carte</span>())
      }, <span class="dt">ignoreInit =</span> T)
    
      <span class="co"># Modification de l'opacite de la representation elargie</span>
      <span class="kw">observeEvent</span>(input<span class="op">$</span>opaciteElargie,{

        proxy &lt;-<span class="st"> </span><span class="kw">leafletProxy</span>(<span class="st">&quot;carte&quot;</span>)

        <span class="co"># on passe la carte leaflet en parametre (map_leaflet = react_carte()).</span>
        <span class="co"># on met a jour la carte proxy avec la nouvelle opacite de la representation elargie.</span>
        proxy &lt;-<span class="st"> </span><span class="kw">set_opacite_elargi</span>(<span class="dt">map =</span> proxy,
                                    <span class="dt">opacite =</span> <span class="kw">as.numeric</span>(input<span class="op">$</span>opaciteElargie)<span class="op">/</span><span class="dv">100</span>,
                                    <span class="dt">map_leaflet =</span> <span class="kw">react_carte</span>())
      }, <span class="dt">ignoreInit =</span> T)
    
      <span class="co"># Modification du style de palette et de la bordure des classes</span>
      <span class="kw">observeEvent</span>(<span class="kw">list</span>(input<span class="op">$</span>stylePalette,input<span class="op">$</span>colBorderClasses),{

        proxy &lt;-<span class="st"> </span><span class="kw">leafletProxy</span>(<span class="st">&quot;carte&quot;</span>)

        <span class="co"># on passe la carte leaflet avec la legende en parametre</span>
        <span class="co"># (map_leaflet = react_legende_carte()).</span>
        <span class="co"># on met a jour la carte proxy pour la nouvelle palette et la bordure des classes.</span>
        proxy &lt;-<span class="st"> </span><span class="kw">set_couleur_classes</span>(<span class="dt">map =</span> proxy,
                                    <span class="dt">stylePalette =</span> input<span class="op">$</span>stylePalette,
                                    <span class="dt">colBorder =</span> input<span class="op">$</span>colBorderClasses,
                                    <span class="dt">map_leaflet =</span> <span class="kw">react_legende_carte</span>())
      }, <span class="dt">ignoreInit =</span> T)
    }
  )</code></pre></div>
</div>
<div id="fleches-joignantes" class="section level2">
<h2>Flèches joignantes</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="kw">library</span>(oceanis)
  <span class="kw">library</span>(shiny)

  <span class="kw">shinyApp</span>(

    <span class="dt">ui =</span> <span class="kw">fluidPage</span>(
        <span class="kw">sidebarLayout</span>(
          <span class="kw">sidebarPanel</span>(
            <span class="kw">uiOutput</span>(<span class="st">&quot;lngFleches_out&quot;</span>),
            <span class="kw">uiOutput</span>(<span class="st">&quot;latFleches_out&quot;</span>),
            <span class="kw">uiOutput</span>(<span class="st">&quot;largeurFleche_out&quot;</span>),
            <span class="kw">uiOutput</span>(<span class="st">&quot;colFleches_out&quot;</span>),
            <span class="kw">uiOutput</span>(<span class="st">&quot;colBorderFleches_out&quot;</span>)
          ),
          <span class="kw">mainPanel</span>(
            <span class="kw">leafletOutput</span>(<span class="st">&quot;carte&quot;</span>, <span class="dt">height =</span> <span class="dv">900</span>)
          )
        )
    ),

    <span class="dt">server =</span> <span class="cf">function</span>(input, output){

      <span class="co"># Declaration et envoi des widgets a l'ui</span>
      output<span class="op">$</span>lngFleches_out &lt;-<span class="st"> </span><span class="kw">renderUI</span>({
        <span class="kw">numericInput</span>(<span class="st">&quot;lngFleches&quot;</span>, <span class="st">&quot;Longitude de la legende des fleches&quot;</span>, <span class="dt">value =</span> <span class="dv">9</span>)
      })
      output<span class="op">$</span>latFleches_out &lt;-<span class="st"> </span><span class="kw">renderUI</span>({
        <span class="kw">numericInput</span>(<span class="st">&quot;latFleches&quot;</span>, <span class="st">&quot;Latitude de la legende des fleches&quot;</span>, <span class="dt">value =</span> <span class="dv">49</span>)
      })
      output<span class="op">$</span>largeurFleche_out &lt;-<span class="st"> </span><span class="kw">renderUI</span>({
        <span class="kw">numericInput</span>(<span class="st">&quot;largeurFleche&quot;</span>, <span class="st">&quot;Largeur de la plus grande fleche&quot;</span>, <span class="dt">value =</span> <span class="dv">50</span>)
      })
      output<span class="op">$</span>colFleches_out &lt;-<span class="st"> </span><span class="kw">renderUI</span>({
        <span class="kw">textInput</span>(<span class="st">&quot;colFleches&quot;</span>, <span class="st">&quot;Couleur de remplissage des fleches&quot;</span>, <span class="dt">value =</span> <span class="kw">c</span>(<span class="st">&quot;#CD853F&quot;</span>))
      })
      output<span class="op">$</span>colBorderFleches_out &lt;-<span class="st"> </span><span class="kw">renderUI</span>({
        <span class="kw">textInput</span>(<span class="st">&quot;colBorderFleches&quot;</span>, <span class="st">&quot;Couleur de la bordure des fleches&quot;</span>, <span class="dt">value =</span> <span class="kw">c</span>(<span class="st">&quot;#303030&quot;</span>))
      })
           
      <span class="co"># Initialisation et envoi de la carte leaflet a l'ui</span>
      output<span class="op">$</span>carte &lt;-<span class="st"> </span><span class="kw">renderLeaflet</span>({
        map &lt;-<span class="st"> </span><span class="kw">leaflet_joignantes</span>(<span class="dt">data =</span> donnees_biloc,
                                  <span class="dt">fondMaille =</span> regm,
                                  <span class="dt">typeMaille =</span> <span class="st">&quot;REG&quot;</span>,
                                  <span class="dt">idDataDepart =</span> <span class="st">&quot;REG_DEPART&quot;</span>,
                                  <span class="dt">idDataArrivee =</span> <span class="st">&quot;REG_ARRIVEE&quot;</span>,
                                  <span class="dt">varFlux =</span> <span class="st">&quot;MIGR&quot;</span>,
                                  <span class="dt">filtreDist =</span> <span class="dv">300</span>,
                                  <span class="dt">decalageAllerRetour =</span> <span class="dv">20</span>,
                                  <span class="dt">decalageCentroid =</span> <span class="dv">20</span>,
                                  <span class="dt">map_proxy =</span> <span class="st">&quot;shiny&quot;</span>)
      })

      <span class="co"># Reactive pour actualiser la carte leaflet</span>
      react_carte &lt;-<span class="st"> </span><span class="kw">reactive</span>({
        map &lt;-<span class="st"> </span><span class="kw">leaflet_joignantes</span>(<span class="dt">data =</span> donnees_biloc,
                                  <span class="dt">fondMaille =</span> regm,
                                  <span class="dt">typeMaille =</span> <span class="st">&quot;REG&quot;</span>,
                                  <span class="dt">idDataDepart =</span> <span class="st">&quot;REG_DEPART&quot;</span>,
                                  <span class="dt">idDataArrivee =</span> <span class="st">&quot;REG_ARRIVEE&quot;</span>,
                                  <span class="dt">varFlux =</span> <span class="st">&quot;MIGR&quot;</span>,
                                  <span class="dt">filtreDist =</span> <span class="dv">300</span>,
                                  <span class="dt">decalageAllerRetour =</span> <span class="dv">20</span>,
                                  <span class="dt">decalageCentroid =</span> <span class="dv">20</span>,
                                  <span class="dt">largeurFlecheMax =</span> <span class="kw">as.numeric</span>(input<span class="op">$</span>largeurFleche),
                                  <span class="dt">colFleche =</span> input<span class="op">$</span>colFleches,
                                  <span class="dt">colBorder =</span> input<span class="op">$</span>colBorderFleches,
                                  <span class="dt">map_proxy =</span> <span class="st">&quot;shiny&quot;</span>)
      })

      <span class="co"># Reactive pour ajouter la legende des fleches a la carte leaflet</span>
      react_legende_carte &lt;-<span class="st"> </span><span class="kw">reactive</span>({
        map &lt;-<span class="st"> </span><span class="kw">add_legende_joignantes</span>(<span class="dt">map =</span> <span class="kw">react_carte</span>(), 
                                    <span class="dt">titre =</span> <span class="st">&quot;MIGR&quot;</span>,
                                    <span class="dt">lng =</span> <span class="kw">as.numeric</span>(input<span class="op">$</span>lngFleches),
                                    <span class="dt">lat =</span> <span class="kw">as.numeric</span>(input<span class="op">$</span>latFleches),
                                    <span class="dt">zoom =</span> <span class="dv">6</span>)
      })

      <span class="co"># Deplacement de la legende des fleches</span>
      <span class="kw">observeEvent</span>(<span class="kw">list</span>(input<span class="op">$</span>lngFleches,input<span class="op">$</span>latFleches),{

        proxy &lt;-<span class="st"> </span><span class="kw">leafletProxy</span>(<span class="st">&quot;carte&quot;</span>)

        <span class="co"># on passe la carte leaflet en parametre (map_leaflet = react_carte()).</span>
        <span class="co"># on met a jour la carte proxy pour la nouvelle position de la legende des fleches.</span>
        proxy &lt;-<span class="st"> </span><span class="kw">add_legende_joignantes</span>(<span class="dt">map =</span> proxy, 
                                        <span class="dt">titre =</span> <span class="st">&quot;MIGR&quot;</span>,
                                        <span class="dt">lng =</span> <span class="kw">as.numeric</span>(input<span class="op">$</span>lngFleches),
                                        <span class="dt">lat =</span> <span class="kw">as.numeric</span>(input<span class="op">$</span>latFleches),
                                        <span class="dt">zoom =</span> <span class="dv">6</span>,
                                        <span class="dt">map_leaflet =</span> <span class="kw">react_carte</span>())
      }, <span class="dt">ignoreInit =</span> T)
  
      <span class="co"># Modification de la largeur des fleches</span>
      <span class="kw">observeEvent</span>(input<span class="op">$</span>largeurFleche,{

        proxy &lt;-<span class="st"> </span><span class="kw">leafletProxy</span>(<span class="st">&quot;carte&quot;</span>)

        <span class="co"># on passe le proxy en parametre (map_proxy = proxy).</span>
        <span class="co"># on utilise isolate() autour des input qui ne changent pas d'etat dans cet observeEvent</span>
        <span class="co"># pour eviter le rafraichissement intempestif de la carte.</span>
        <span class="co"># on met a jour la carte proxy avec la nouvelle largeur de fleches.</span>
        proxy &lt;-<span class="st"> </span><span class="kw">leaflet_joignantes</span>(<span class="dt">data =</span> donnees_biloc,
                                    <span class="dt">fondMaille =</span> regm,
                                    <span class="dt">typeMaille =</span> <span class="st">&quot;REG&quot;</span>,
                                    <span class="dt">idDataDepart =</span> <span class="st">&quot;REG_DEPART&quot;</span>,
                                    <span class="dt">idDataArrivee =</span> <span class="st">&quot;REG_ARRIVEE&quot;</span>,
                                    <span class="dt">varFlux =</span> <span class="st">&quot;MIGR&quot;</span>,
                                    <span class="dt">filtreDist =</span> <span class="dv">300</span>,
                                    <span class="dt">decalageAllerRetour =</span> <span class="dv">20</span>,
                                    <span class="dt">decalageCentroid =</span> <span class="dv">20</span>,
                                    <span class="dt">largeurFlecheMax =</span> <span class="kw">as.numeric</span>(input<span class="op">$</span>largeurFleche),
                                    <span class="dt">colFleche =</span> <span class="kw">isolate</span>(input<span class="op">$</span>colFleches),
                                    <span class="dt">colBorder =</span> <span class="kw">isolate</span>(input<span class="op">$</span>colBorderFleches),
                                    <span class="dt">map_proxy =</span> proxy)

        <span class="co"># on passe la carte leaflet en parametre (map_leaflet = react_carte()).</span>
        <span class="co"># on met a jour la carte proxy pour la nouvelle largeur de fleches dans la legende.</span>
        proxy &lt;-<span class="st"> </span><span class="kw">add_legende_joignantes</span>(<span class="dt">map =</span> proxy,
                                        <span class="dt">titre =</span> <span class="st">&quot;MIGR&quot;</span>,
                                        <span class="dt">lng =</span> <span class="kw">as.numeric</span>(<span class="kw">isolate</span>(input<span class="op">$</span>lngFleches)),
                                        <span class="dt">lat =</span> <span class="kw">as.numeric</span>(<span class="kw">isolate</span>(input<span class="op">$</span>latFleches)),
                                        <span class="dt">zoom =</span> <span class="dv">6</span>,
                                        <span class="dt">map_leaflet =</span> <span class="kw">react_carte</span>())
      }, <span class="dt">ignoreInit =</span> T)
    
      <span class="co"># Modification de la couleur des fleches et de leur bordure</span>
      <span class="kw">observeEvent</span>(<span class="kw">list</span>(input<span class="op">$</span>colFleches,input<span class="op">$</span>colBorderFleches),{

        proxy &lt;-<span class="st"> </span><span class="kw">leafletProxy</span>(<span class="st">&quot;carte&quot;</span>)
        
        <span class="co"># on passe la carte leaflet avec la legende en parametre</span>
        <span class="co"># (map_leaflet = react_legende_carte()).</span>
        <span class="co"># on met a jour la carte proxy pour la nouvelle couleur des fleches et des bordures.</span>
        proxy &lt;-<span class="st"> </span><span class="kw">set_couleur_joignantes</span>(<span class="dt">map =</span> proxy,
                                        <span class="dt">colFleche =</span> input<span class="op">$</span>colFleches,
                                        <span class="dt">colBorder =</span> input<span class="op">$</span>colBorderFleches,
                                        <span class="dt">map_leaflet =</span> <span class="kw">react_legende_carte</span>())
      }, <span class="dt">ignoreInit =</span> T)
    }
  )</code></pre></div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
